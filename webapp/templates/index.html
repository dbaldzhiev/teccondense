<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Condensation Risk Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <style>
      /* Small inline fallback if static not served */
      body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#0f172a;color:#e5e7eb}
      .container{max-width:1100px;margin:0 auto;padding:24px}
      h1{margin:0 0 12px;font-size:28px}
      .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
      .card{background:#111827;border:1px solid #374151;border-radius:10px;padding:16px}
      label{display:block;font-size:12px;color:#9ca3af;margin:6px 0 4px}
      input,select{width:100%;padding:8px;border-radius:8px;border:1px solid #374151;background:#0b1220;color:#e5e7eb}
      .row{display:grid;grid-template-columns:1.5fr repeat(6,1fr);gap:8px;align-items:end}
      .btn{background:#2563eb;border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
      .btn.secondary{background:#374151}
      .btn.danger{background:#dc2626}
      .actions{display:flex;gap:8px;flex-wrap:wrap}
      .charts{display:grid;grid-template-columns:1fr 1fr;gap:16px}
      canvas{width:100%;height:300px;background:#0b1220;border:1px solid #374151;border-radius:8px}
      .footer{opacity:.7;margin-top:12px;font-size:12px}
    </style>
    <script defer src="{{ url_for('static', filename='app.js') }}"></script>
</head>
<body>
  <div class="container">
    <h1>Condensation Risk Calculator</h1>
    <div class="grid">
      <div class="card">
        <h3>Layers (inside → outside)</h3>
        <div id="layers"></div>
        <div class="actions" style="margin-top:8px">
          <button class="btn" onclick="addLayer()">Add Layer</button>
          <button class="btn danger" onclick="removeLayer()">Remove Last</button>
          <button class="btn secondary" onclick="loadMaterials()">Load Materials</button>
        </div>
      </div>
      <div class="card">
        <h3>Climate & Surface Resistances</h3>
        <div class="row">
          <div>
            <label>θi (°C)</label>
            <input type="number" step="0.1" id="theta_i" value="20">
          </div>
          <div>
            <label>φi (%)</label>
            <input type="number" step="0.1" id="phi_i" value="65">
          </div>
          <div>
            <label>θe (°C)</label>
            <input type="number" step="0.1" id="theta_e" value="5">
          </div>
          <div>
            <label>φe (%)</label>
            <input type="number" step="0.1" id="phi_e" value="90">
          </div>
          <div>
            <label>Rsi (m²·K/W)</label>
            <input type="number" step="0.01" id="Rsi" value="0.13">
          </div>
          <div>
            <label>Rse (m²·K/W)</label>
            <input type="number" step="0.01" id="Rse" value="0.04">
          </div>
        </div>
        <div class="row">
          <div>
            <label>tk (h)</label>
            <input type="number" step="1" id="tk" value="1440">
          </div>
          <div>
            <label>tu (h)</label>
            <input type="number" step="1" id="tu" value="1440">
          </div>
          <div>
            <label>Climate Preset</label>
            <select id="climatePreset">
              <option value="">—</option>
              <option value="5">θe=5°C (>-8.5°C)</option>
              <option value="-5">θe=-5°C (-8.5…-14.5°C)</option>
              <option value="-10">θe=-10°C (<-14.5°C)</option>
            </select>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn secondary" onclick="applyClimatePreset()" type="button">Apply Preset</button>
          </div>
        </div>
        <div class="actions" style="margin-top:10px">
          <button class="btn" onclick="runAnalyze()" type="button">Calculate</button>
        </div>
      </div>
    </div>

    <div class="grid" style="margin-top:16px">
      <div class="card">
        <h3>Results</h3>
        <div id="results">Fill layers and click Calculate.</div>
      </div>
      <div class="card">
        <h3>Condensation Zones</h3>
        <div id="zones">—</div>
      </div>
    </div>

    <div class="charts" style="margin-top:16px">
      <div class="card">
        <h3>Assembly Diagram (Layers + &theta;)</h3>
        <canvas id="chartAssembly"></canvas>
        <div class="footer">Shaded red: condensation within layers (mapped from Σz). Interfaces are vertical lines.</div>
      </div>
      <div class="card">
        <h3>Temperature vs Σd (m)</h3>
        <canvas id="chartTemp"></canvas>
      </div>
      <div class="card">
        <h3>p and p_sat vs z (m²Pa·h/kg)</h3>
        <canvas id="chartVapor"></canvas>
      </div>
    </div>
    <div class="card" style="margin-top:16px">
      <h3>Generated Report</h3>
      <div id="report-html"></div>
    </div>
    <div class="footer">Tip: Use material presets per layer, and adjust thickness sliders for quick what-if analysis.</div>
  </div>

</body>
</html>

